<!DOCTYPE html>
<html lang="fr">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Espace - AEESS Soninkara UGB</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
Â  <style>
Â  Â  /* ðŸŽ¨ Couleurs officielles AEESS */
Â  Â  :root {
Â  Â  Â  --vert-principal: #3CA64A;Â  Â /* vert du logo */
Â  Â  Â  --vert-fonce: #2C7034;Â  Â  Â  Â /* variante foncÃ©e */
Â  Â  Â  --blanc: #FFFFFF;
Â  Â  Â  --noir: #000000;
Â  Â  Â  --gris-clair: #f8f8f8;
Â  Â  Â  --transition: all 0.3s ease;
      --box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      --border-radius: 8px;
Â  Â  }

Â  Â  body {
Â  Â  Â  margin: 0;
Â  Â  Â  font-family: 'Open Sans', Arial, sans-serif;
Â  Â  Â  background: var(--gris-clair);
Â  Â  Â  color: var(--noir);
Â  Â  Â  line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
Â  Â  }

Â  Â  h1, h2, h3 {
Â  Â  Â  font-family: 'Merriweather', Georgia, serif;
Â  Â  Â  color: var(--vert-fonce);
Â  Â  }

Â  Â  /* ðŸŸ© Header */
Â  Â  header {
Â  Â  Â  background: var(--vert-principal);
Â  Â  Â  color: var(--blanc);
Â  Â  Â  text-align: center;
Â  Â  Â  padding: 1.5rem 1rem;
      box-shadow: var(--box-shadow);
Â  Â  }

Â  Â  header h1 {
Â  Â  Â  margin: 0;
Â  Â  Â  font-size: 2rem;
Â  Â  }

Â  Â  header p {
Â  Â  Â  margin: 0.5rem 0 0;
Â  Â  Â  font-style: italic;
Â  Â  }

Â  Â  /* ðŸ”— Navigation */
Â  Â  nav {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: center;
Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  background: var(--vert-fonce);
Â  Â  }

Â  Â  .nav-btn {
Â  Â  Â  background: none;
Â  Â  Â  border: none;
Â  Â  Â  color: var(--blanc);
Â  Â  Â  font-weight: bold;
Â  Â  Â  padding: 1rem 1.5rem;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: background 0.3s;
Â  Â  }

Â  Â  .nav-btn:hover,
Â  Â  .nav-btn:focus-visible {
Â  Â  Â  background: var(--vert-principal);
Â  Â  Â  outline: none;
Â  Â  }
    
    .logout-btn {
        background: none;
        border: 2px solid #fff;
        color: #fff;
        padding: 0.5rem 1rem;
        border-radius: var(--border-radius);
        margin: 0.5rem 1rem;
    }
    .logout-btn:hover {
        background: #fff;
        color: var(--vert-fonce);
    }

Â  Â  /* ðŸ“¦ Contenu principal */
Â  Â  main {
Â  Â  Â  flex: 1;
Â  Â  Â  max-width: 1100px;
Â  Â  Â  margin: 2rem auto;
Â  Â  Â  background: var(--blanc);
Â  Â  Â  padding: 2rem;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  box-shadow: 0 3px 8px rgba(0,0,0,0.1);
Â  Â  }

Â  Â  /* ðŸŸ¢ Onglets */
Â  Â  .tab-list {
Â  Â  Â  display: flex;
Â  Â  Â  gap: 1rem;
Â  Â  Â  margin-bottom: 1.5rem;
Â  Â  Â  flex-wrap: wrap;
Â  Â  }

Â  Â  .tab-btn {
Â  Â  Â  padding: 0.7rem 1.2rem;
Â  Â  Â  border: 2px solid var(--vert-principal);
Â  Â  Â  background: var(--blanc);
Â  Â  Â  color: var(--vert-fonce);
Â  Â  Â  border-radius: 6px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  font-weight: bold;
Â  Â  Â  transition: all 0.3s;
Â  Â  }

Â  Â  .tab-btn[aria-selected="true"] {
Â  Â  Â  background: var(--vert-principal);
Â  Â  Â  color: var(--blanc);
Â  Â  }

Â  Â  .tab-btn:focus-visible {
Â  Â  Â  outline: 2px solid var(--vert-principal);
Â  Â  Â  outline-offset: 2px;
Â  Â  }

Â  Â  .tab-content {
Â  Â  Â  display: none;
Â  Â  }

Â  Â  .tab-content.active {
Â  Â  Â  display: block;
Â  Â  Â  border-left: 4px solid var(--vert-principal);
Â  Â  Â  padding-left: 1rem;
Â  Â  }

    .user-info, .section-content {
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: var(--border-radius);
        margin-bottom: 2rem;
    }

    .user-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
    }
    
    .list-container {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    .list-item {
        background: white;
        padding: 1rem;
        border-radius: var(--border-radius);
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .form-group {
        margin-bottom: 1rem;
    }
    
    input, textarea, select {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: var(--border-radius);
        font-family: inherit;
    }
    
    .btn {
        display: inline-block;
        padding: 12px 30px;
        background-color: var(--vert-principal);
        color: #fff;
        text-decoration: none;
        border-radius: var(--border-radius);
        font-weight: bold;
        transition: all 0.3s ease;
        border: 2px solid var(--vert-principal);
        cursor: pointer;
    }

Â  Â  /* âš« Footer */
Â  Â  footer {
Â  Â  Â  background: var(--noir);
Â  Â  Â  color: var(--blanc);
Â  Â  Â  text-align: center;
Â  Â  Â  padding: 1rem;
Â  Â  Â  margin-top: 2rem;
Â  Â  Â  font-size: 0.9rem;
Â  Â  }
Â  </style>
</head>
<body>

Â  Â  <header>
Â  Â  <h1>Association des Ã‰lÃ¨ves et Ã‰tudiants SoninkÃ© - UGB</h1>
Â  Â  <p><em>Soninkara djikÃ© na rÃªmou na</em></p>
Â  </header>

Â  Â  <nav>
Â  Â  <button class="nav-btn" data-tab="presentation">PrÃ©sentation</button>
Â  Â  <button class="nav-btn" data-tab="demandes">Demandes d'Aide</button>
    <button class="nav-btn" data-tab="partages">Espace de Partage</button>
Â  Â  <button class="nav-btn" id="logout-btn">Se dÃ©connecter</button>
Â  </nav>

Â  Â  <main>
Â  Â  <h2 style="display: none;">Espace AEESS</h2>

Â  Â  Â  Â  <div role="tablist" class="tab-list" style="display: none;">
Â  Â  Â  <button role="tab" id="tab-1" class="tab-btn" aria-selected="true" aria-controls="content-1" tabindex="0">PrÃ©sentation</button>
Â  Â  Â  <button role="tab" id="tab-2" class="tab-btn" aria-selected="false" aria-controls="content-2" tabindex="-1">ActualitÃ©s</button>
Â  Â  Â  <button role="tab" id="tab-3" class="tab-btn" aria-selected="false" aria-controls="content-3" tabindex="-1">Documents</button>
Â  Â  </div>
    
    <div id="loading-message" style="text-align: center; font-size: 1.5rem;">Chargement...</div>
    <div id="content-container" style="display: none;">
        
        <section id="demandes" class="tab-content active" aria-labelledby="tab-demandes">
            <h2>Demander de l'aide</h2>
            <div class="section-content">
                <h3>Poser une question ou demander un cours</h3>
                <form id="demande-form">
                    <div class="form-group">
                        <input type="text" id="demande-sujet" placeholder="Sujet (ex: Cours de MathÃ©matiques)" required>
                    </div>
                    <div class="form-group">
                        <select id="demande-filiere" required>
                            <option value="">SÃ©lectionnez votre UFR/FiliÃ¨re</option>
                            <option value="UFR SJEJ">UFR SJEJ</option>
                            <option value="UFR LSH">UFR LSH</option>
                            <option value="UFR SEFS">UFR SEFS</option>
                            <option value="Autres">Autres</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <textarea id="demande-description" rows="4" placeholder="Description de votre demande" required></textarea>
                    </div>
                    <button type="submit" class="btn">Envoyer la demande</button>
                </form>
            </div>
            <div class="section-content">
                <h3>Demandes rÃ©centes</h3>
                <div class="form-group">
                    <label for="filter-filiere">Filtrer par filiÃ¨re :</label>
                    <select id="filter-filiere">
                        <option value="all">Toutes les filiÃ¨res</option>
                        <option value="UFR SJEJ">UFR SJEJ</option>
                        <option value="UFR LSH">UFR LSH</option>
                        <option value="UFR SEFS">UFR SEFS</option>
                        <option value="Autres">Autres</option>
                    </select>
                </div>
                <div id="demandes-list" class="list-container">
                </div>
            </div>
        </section>

        <section id="partages" class="tab-content" aria-labelledby="tab-partages">
            <h2>Espace de Partage</h2>
            <div class="section-content">
                <h3>TÃ©lÃ©charger un document ou une image</h3>
                <form id="upload-form">
                    <div class="form-group">
                        <input type="file" id="file-upload" required>
                    </div>
                    <div class="form-group">
                        <input type="text" id="file-title" placeholder="Titre du document" required>
                    </div>
                    <button type="submit" class="btn">TÃ©lÃ©charger</button>
                </form>
            </div>
            <div class="section-content">
                <h3>Documents partagÃ©s</h3>
                <div id="partages-list" class="list-container">
                </div>
            </div>
        </section>
        
    </div>
Â  </main>

Â  Â  <footer>
Â  Â  <p>&copy; 2025 AEESS - Soninkara UGB | Tous droits rÃ©servÃ©s</p>
Â  </footer>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Initialisation de Supabase
    const supabaseUrl = 'https://oqpbotaerbpcmwffsyjf.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xcGJvdGFlcmJwY213ZmZzeWpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyMzE1NDgsImV4cCI6MjA3MzgwNzU0OH0.iY7VX-yDdtAL75hjwle_xd5Ge3LhcEAd4DlXz1dN5PA';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    const navBtns = document.querySelectorAll('.nav-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    const logoutBtn = document.getElementById('logout-btn');
    const loadingMessage = document.getElementById('loading-message');
    const contentContainer = document.getElementById('content-container');

    function showTab(tabId) {
        tabContents.forEach(content => content.style.display = 'none');
        const activeContent = document.getElementById(tabId);
        if (activeContent) {
            activeContent.style.display = 'block';
        }
    }
    
    navBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
            const targetTab = btn.dataset.tab;
            if (targetTab) {
                showTab(targetTab);
            }
        });
    });
    
    function redirectToLogin() {
        window.location.href = 'index.html';
    }

    async function checkSession() {
        loadingMessage.style.display = 'block';
        contentContainer.style.display = 'none';

        try {
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                loadingMessage.style.display = 'none';
                contentContainer.style.display = 'block';
                showTab('demandes'); // Afficher l'onglet Demandes par dÃ©faut
                loadDemandes('all');
                loadPartages();
            } else {
                redirectToLogin();
            }
        } catch (error) {
            console.error("Erreur de session:", error);
            redirectToLogin();
        }
    }
    
    logoutBtn.addEventListener('click', async (e) => {
        e.preventDefault();
        const { error } = await supabase.auth.signOut();
        if (!error) {
            redirectToLogin();
        }
    });

    document.addEventListener('DOMContentLoaded', checkSession);

    /* ------------------------------------------- */
    /* Fonctions pour les nouvelles fonctionnalitÃ©s */
    /* ------------------------------------------- */

    const demandeForm = document.getElementById('demande-form');
    demandeForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const sujet = document.getElementById('demande-sujet').value;
        const filiere = document.getElementById('demande-filiere').value;
        const description = document.getElementById('demande-description').value;
        const { data: { session } } = await supabase.auth.getSession();
        const user = session?.user;

        const { error } = await supabase
            .from('demandes')
            .insert([{
                sujet: sujet,
                filiere: filiere,
                description: description,
                auteur_id: user.id
            }]);

        if (error) {
            console.error("Erreur lors de l'envoi de la demande:", error);
            alert("Erreur lors de l'envoi de la demande.");
        } else {
            alert("Votre demande a Ã©tÃ© envoyÃ©e avec succÃ¨s !");
            demandeForm.reset();
        }
    });

    const filterFiliere = document.getElementById('filter-filiere');

    async function loadDemandes(filiereFilter = 'all') {
        const demandesList = document.getElementById('demandes-list');
        demandesList.innerHTML = '';
        
        let query = supabase.from('demandes').select(`*, profiles:auteur_id (full_name)`);

        if (filiereFilter !== 'all') {
            query = query.eq('filiere', filiereFilter);
        }
        
        const { data, error } = await query.order('created_at', { ascending: false });

        if (error) {
            console.error("Erreur lors du chargement des demandes:", error);
            return;
        }

        if (data.length > 0) {
            data.forEach(demande => {
                const item = document.createElement('div');
                item.className = 'list-item';
                item.innerHTML = `
                    <h4>[${demande.filiere}] ${demande.sujet}</h4>
                    <p>${demande.description}</p>
                    <small>De : ${demande.profiles?.full_name || 'Anonyme'}</small>
                `;
                demandesList.appendChild(item);
            });
        } else {
            demandesList.innerHTML = '<p>Aucune demande pour le moment dans cette filiÃ¨re.</p>';
        }
    }

    filterFiliere.addEventListener('change', (e) => {
        loadDemandes(e.target.value);
    });

    const uploadForm = document.getElementById('upload-form');
    uploadForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const file = document.getElementById('file-upload').files[0];
        const title = document.getElementById('file-title').value;
        const { data: { session } } = await supabase.auth.getSession();
        const user = session?.user;
        
        if (!file) {
            alert("Veuillez sÃ©lectionner un fichier.");
            return;
        }

        const filePath = `${user.id}/${Date.now()}_${file.name}`;
        const { error: uploadError } = await supabase.storage
            .from('documents')
            .upload(filePath, file);

        if (uploadError) {
            console.error("Erreur lors du tÃ©lÃ©chargement:", uploadError);
            alert("Erreur lors du tÃ©lÃ©chargement du fichier: " + uploadError.message);
            return;
        }

        const { error: dbError } = await supabase
            .from('partages')
            .insert([{
                titre: title,
                url: `${supabaseUrl}/storage/v1/object/public/documents/${filePath}`,
                auteur_id: user.id
            }]);

        if (dbError) {
            console.error("Erreur lors de l'enregistrement de la rÃ©fÃ©rence:", dbError);
            alert("Fichier tÃ©lÃ©chargÃ©, mais erreur d'enregistrement de la rÃ©fÃ©rence.");
        } else {
            alert("Fichier partagÃ© avec succÃ¨s !");
            uploadForm.reset();
            loadPartages();
        }
    });

    async function loadPartages() {
        const partagesList = document.getElementById('partages-list');
        partagesList.innerHTML = '';
        
        const { data, error } = await supabase
            .from('partages')
            .select(`*, profiles:auteur_id (full_name)`)
            .order('created_at', { ascending: false });

        if (error) {
            console.error("Erreur lors du chargement des partages:", error);
            return;
        }

        if (data.length > 0) {
            data.forEach(partage => {
                const item = document.createElement('div');
                item.className = 'list-item';
                item.innerHTML = `
                    <h4>${partage.titre}</h4>
                    <p><a href="${partage.url}" target="_blank">Voir le document</a></p>
                    <small>De : ${partage.profiles?.full_name || 'Anonyme'}</small>
                `;
                partagesList.appendChild(item);
            });
        } else {
            partagesList.innerHTML = '<p>Aucun document partagÃ© pour le moment.</p>';
        }
    }
  </script>
</body>
</html>
